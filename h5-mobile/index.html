<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>智能营养助手</title>
    <script>
      // 设置 rem 基准值（带调试：监控是否被其他脚本覆盖）
      (function (doc, win) {
        const docEl = doc.documentElement
        const resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize'
        const BASE = 9 // rem 基准常量（px）: BASE * (clientWidth / 375)

        function setRootFontSize() {
          const clientWidth = docEl.clientWidth
          if (!clientWidth) return
          const newSize = BASE * (clientWidth / 375) + 'px'
          const before = getComputedStyle(docEl).fontSize
          // 直接设置精确值（覆盖任何内联样式）
          docEl.style.fontSize = newSize
          const after = getComputedStyle(docEl).fontSize
          console.debug('[rem] setRootFontSize', { before, setTo: newSize, after })
        }

        // 监控 html 元素 style 的 fontSize 变化，便于定位覆盖来源
        try {
          const mo = new MutationObserver(muts => {
            muts.forEach(m => {
              if (m.attributeName === 'style') {
                const fs = docEl.style.fontSize || getComputedStyle(docEl).fontSize
                console.warn('[rem] html font-size changed ->', fs)
                try {
                  // 打印堆栈以帮助定位调用者（仅在 Dev 环境有用）
                  throw new Error('trace font-size change')
                } catch (e) {
                  console.trace(e)
                }
              }
            })
          })
          mo.observe(docEl, { attributes: true, attributeFilter: ['style'] })
        } catch (e) {
          console.warn('[rem] MutationObserver not available', e)
        }

        if (!doc.addEventListener) return
        win.addEventListener(resizeEvt, setRootFontSize, false)
        // 在 DOMContentLoaded 和 load 时都执行一次，确保在各种注入后校准
        doc.addEventListener('DOMContentLoaded', setRootFontSize, false)
        win.addEventListener('load', () => {
          // 延迟执行，等待其他脚本运行
          setTimeout(setRootFontSize, 50)
        })
      })(document, window)
    </script>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>

